{"ast":null,"code":"var _jsxFileName = \"D:\\\\AutoML\\\\app\\\\frontend\\\\src\\\\pages\\\\Conversation.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport styles from './conversation_style.module.css';\nimport { callApi } from '../api/client'; // Ensure this points to your API client function\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst BACKEND_SYSTEM_PROMPT_INITIAL_CORE = `\nYou are an AI assisting with business problem definition.\nThe user will provide a brief business problem statement.\nYour task is to:\n1. Analyze the user's problem statement.\n2. Decide if you need more information to understand the problem deeply enough to formulate a well-defined business problem statement.\n3. If you need more information, ask ONE clarifying question.  The question should be specific and help you understand a crucial aspect of the problem.\n4. If you believe you have enough information to formulate a problem statement, your response MUST START with the EXACT phrase: \"Ready to formulate problem.\" and nothing else before it. Do not ask a question in this case.\nYour response should follow one of these formats:\nFormat 1: Asking a Clarifying Question (if more info needed):\n<Your clarifying question>\nFormat 2: Ready to formulate problem (if enough info):\nReady to formulate problem.  (Your response MUST START with this EXACT phrase)\nExample:\nWhat specific metrics are you currently tracking to measure this problem?\nStart the process now.\n`.trim().toLowerCase();\nconst BACKEND_SYSTEM_PROMPT_NEXT_ITERATION_CORE = `\nYou are continuing to assist with business problem definition.\nThe user has responded to your previous question.\nYour task is to:\n1. Review the entire conversation so far, including the initial problem statement and the user's responses to your questions.\n2. Decide if you now have enough information to formulate a well-defined business problem statement.\n3. If you still need more information, ask ONE more clarifying question.\n4. If you believe you have enough information NOW to formulate a problem statement, your response MUST START with the EXACT phrase: \"Ready to formulate problem.\" and nothing else before it.\nYour response should follow one of these formats:\nFormat 1: Asking a Clarifying Question:\n<Your clarifying question>\nFormat 2: Ready to formulate problem:\nReady to formulate problem. (Your response MUST START with this EXACT phrase)\nContinue the process.\n`.trim().toLowerCase();\nexport default function Conversation() {\n  _s();\n  const {\n    state\n  } = useLocation();\n  const [conversation, setConversation] = useState([]);\n  const [userResponse, setUserResponse] = useState('');\n  const [isFinal, setIsFinal] = useState(false);\n  const [finalProblemText, setFinalProblemText] = useState('');\n  const [isLoading, setIsLoading] = useState(false); // Combined loading state\n  const [pipelineStatus, setPipelineStatus] = useState('idle');\n  const [pipelineMessage, setPipelineMessage] = useState('');\n  const conversationEndRef = useRef(null);\n\n  // Helper function to filter and set conversation state\n  const processAndSetConversation = (convoData, finalProblemData) => {\n    const filteredConvo = (convoData || []).filter(msg => !msg.startsWith('FileDetails:') && !(msg.startsWith('User:') && (convoData || []).indexOf(msg) === 0));\n    setConversation(filteredConvo);\n    if (finalProblemData) {\n      setFinalProblemText(finalProblemData);\n      setIsFinal(true);\n      setPipelineStatus('conversation_complete'); // Ready to start pipeline\n    } else if (filteredConvo.length > 0) {\n      setPipelineStatus('conversation'); // Still in conversation phase\n    } else {\n      // Handle case where convo is empty and no final problem\n      setPipelineStatus('error');\n      setPipelineMessage('Conversation initialization failed or empty.');\n    }\n  };\n\n  // --- Effect 1: Initial Load and Server Sync ---\n  useEffect(() => {\n    const locationState = state;\n    let initialConvoFromState = [];\n    let initialFinalProblemFromState = null;\n    if (locationState) {\n      initialConvoFromState = locationState.conversation || [];\n      initialFinalProblemFromState = locationState.final_problem || null;\n    }\n    setIsLoading(true);\n    setPipelineStatus('initializing');\n    setPipelineMessage('Initializing conversation...');\n    if (initialFinalProblemFromState) {\n      processAndSetConversation(initialConvoFromState, initialFinalProblemFromState);\n      setIsLoading(false);\n      setPipelineMessage('');\n    } else {\n      callApi('conversation', 'GET').then(data => {\n        if (data && data.conversation) {\n          processAndSetConversation(data.conversation, data.final_problem);\n        } else {\n          console.error(\"GET /api/conversation response missing data:\", data);\n          setPipelineStatus('error');\n          setPipelineMessage('Failed to get initial conversation state from server.');\n        }\n      }).catch(err => {\n        console.error(\"Initial GET /api/conversation failed:\", err);\n        setPipelineStatus('error');\n        setPipelineMessage(`Failed to connect: ${err.message || 'Network error'}`);\n      }).finally(() => {\n        setIsLoading(false);\n        if (pipelineStatus !== 'error') {\n          setPipelineMessage('');\n        }\n      });\n    }\n  }, [state]); // Dependency array for initial load\n\n  // --- Effect 2: Scroll Conversation ---\n  useEffect(() => {\n    if (pipelineStatus === 'conversation' || pipelineStatus === 'initializing') {\n      var _conversationEndRef$c;\n      (_conversationEndRef$c = conversationEndRef.current) === null || _conversationEndRef$c === void 0 ? void 0 : _conversationEndRef$c.scrollIntoView({\n        behavior: 'smooth'\n      });\n    }\n  }, [conversation, pipelineStatus, isLoading]);\n\n  // --- Effect 3: Trigger Pipeline Steps ---\n  useEffect(() => {\n    const runPipelineStep = async step => {\n      var _resultData, _resultData2, _resultData3, _resultData4, _resultData5, _resultData6, _resultData7, _resultData8, _resultData9, _resultData10, _resultData11, _resultData12, _resultData13, _resultData14, _resultData15;\n      let nextStep = '';\n      let success = false;\n      let errorMessage = '';\n      let apiEndpoint = '';\n      let apiMethod = 'POST';\n      let resultData = null;\n      setIsLoading(true);\n      try {\n        switch (step) {\n          case 'processing_eda':\n            setPipelineMessage('Generating & Running EDA...');\n            apiEndpoint = 'dataanalysis';\n            resultData = await callApi(apiEndpoint, apiMethod);\n            success = ((_resultData = resultData) === null || _resultData === void 0 ? void 0 : _resultData.status) === 'success';\n            if (!success) errorMessage = ((_resultData2 = resultData) === null || _resultData2 === void 0 ? void 0 : _resultData2.error) || ((_resultData3 = resultData) === null || _resultData3 === void 0 ? void 0 : _resultData3.details) || 'EDA execution failed.';else nextStep = 'processing_plan';\n            break;\n          case 'processing_plan':\n            setPipelineMessage('Generating ML Plan...');\n            apiEndpoint = 'superllm';\n            resultData = await callApi(apiEndpoint, apiMethod);\n            success = ((_resultData4 = resultData) === null || _resultData4 === void 0 ? void 0 : _resultData4.status) === 'plan_generated';\n            if (!success) errorMessage = ((_resultData5 = resultData) === null || _resultData5 === void 0 ? void 0 : _resultData5.error) || ((_resultData6 = resultData) === null || _resultData6 === void 0 ? void 0 : _resultData6.details) || 'ML plan generation failed.';else nextStep = 'processing_ml';\n            break;\n          case 'processing_ml':\n            setPipelineMessage('Generating & Running ML Code...');\n            apiEndpoint = 'ml';\n            resultData = await callApi(apiEndpoint, apiMethod);\n            success = ((_resultData7 = resultData) === null || _resultData7 === void 0 ? void 0 : _resultData7.status) === 'success';\n            if (!success) errorMessage = ((_resultData8 = resultData) === null || _resultData8 === void 0 ? void 0 : _resultData8.error) || ((_resultData9 = resultData) === null || _resultData9 === void 0 ? void 0 : _resultData9.details) || 'ML execution failed.';else nextStep = 'processing_viz_plan';\n            break;\n          case 'processing_viz_plan':\n            setPipelineMessage('Generating Visualization Plan...');\n            apiEndpoint = 'visualizationplanning';\n            resultData = await callApi(apiEndpoint, apiMethod);\n            success = ((_resultData10 = resultData) === null || _resultData10 === void 0 ? void 0 : _resultData10.status) === 'plan_generated';\n            if (!success) errorMessage = ((_resultData11 = resultData) === null || _resultData11 === void 0 ? void 0 : _resultData11.error) || ((_resultData12 = resultData) === null || _resultData12 === void 0 ? void 0 : _resultData12.details) || 'Visualization plan generation failed.';else nextStep = 'processing_viz';\n            break;\n          case 'processing_viz':\n            setPipelineMessage('Generating & Running Visualizations...');\n            apiEndpoint = 'visualizations';\n            resultData = await callApi(apiEndpoint, apiMethod);\n            success = ((_resultData13 = resultData) === null || _resultData13 === void 0 ? void 0 : _resultData13.status) === 'success';\n            if (!success) errorMessage = ((_resultData14 = resultData) === null || _resultData14 === void 0 ? void 0 : _resultData14.error) || ((_resultData15 = resultData) === null || _resultData15 === void 0 ? void 0 : _resultData15.message) || 'Visualization execution failed.';else nextStep = 'complete';\n            break;\n          default:\n            console.warn(\"Unknown pipeline step:\", step);\n            setIsLoading(false);\n            return;\n        }\n        if (success) {\n          setPipelineStatus(nextStep);\n        } else {\n          setPipelineStatus('error');\n          setPipelineMessage(`Error during ${step.replace('processing_', '')}: ${errorMessage}`);\n        }\n      } catch (err) {\n        console.error(`API call failed for ${step} (${apiEndpoint}):`, err);\n        setPipelineStatus('error');\n        setPipelineMessage(`Error during ${step.replace('processing_', '')}: ${err.message || 'Network or API error'}`);\n      } finally {\n        if (!success || nextStep === 'complete') {\n          setIsLoading(false);\n        }\n      }\n    };\n    if (pipelineStatus === 'conversation_complete') {\n      const timer = setTimeout(() => {\n        setPipelineStatus('processing_eda');\n      }, 500);\n      return () => clearTimeout(timer);\n    } else if (pipelineStatus.startsWith('processing_')) {\n      runPipelineStep(pipelineStatus);\n    } else if (pipelineStatus === 'complete') {\n      setPipelineMessage('Processing Complete! Visualizations generated.');\n      setIsLoading(false);\n    } else if (pipelineStatus === 'error') {\n      setIsLoading(false);\n    }\n  }, [pipelineStatus]); // Dependency array for pipeline\n\n  // --- Handle User Submission ---\n  const handleSubmit = async e => {\n    e.preventDefault();\n    if (!userResponse.trim() || isLoading || isFinal || pipelineStatus !== 'conversation') return;\n    const answer = userResponse.trim();\n    const currentConvoSnapshot = [...conversation];\n    const updatedConvoUI = [...currentConvoSnapshot, `User: ${answer}`];\n    setConversation(updatedConvoUI);\n    setUserResponse('');\n    setIsLoading(true);\n    setPipelineMessage('');\n    try {\n      const data = await callApi('conversation', 'POST', {\n        user_response: answer\n      });\n      const newConvo = data.conversation || [];\n      const finalProblemData = data.final_problem || null;\n      processAndSetConversation(newConvo, finalProblemData);\n    } catch (err) {\n      console.error('API call failed:', err);\n      setConversation(currentConvoSnapshot);\n      setUserResponse(answer);\n      setPipelineStatus('error');\n      setPipelineMessage(`Failed to get response: ${err.message || 'API error'}`);\n    } finally {\n      if (!isFinal) {\n        // Use the updated isFinal state here\n        setIsLoading(false);\n      }\n    }\n  };\n\n  // Helper to clean messages\n  const cleanMessage = (msg, prefixToRemove) => {\n    let cleaned = msg.startsWith(prefixToRemove) ? msg.substring(prefixToRemove.length).trim() : msg.trim();\n    cleaned = cleaned.replace(/^question\\s*\\d+\\)\\s*/i, '').trim();\n    cleaned = cleaned.replace(/^ai:\\s*/i, '').trim();\n    return cleaned;\n  };\n\n  // Filter system messages\n  const shouldDisplaySystemMessage = msg => {\n    if (!msg.startsWith('System:')) return true;\n    const cleanedMsg = msg.substring('System:'.length).trim();\n    const content = cleanedMsg.toLowerCase();\n    if (content === BACKEND_SYSTEM_PROMPT_INITIAL_CORE || content === BACKEND_SYSTEM_PROMPT_NEXT_ITERATION_CORE) {\n      return false;\n    }\n    const hiddenPhrases = [\"you are \", \"your task is\", \"format 1:\", \"format 2:\", \"decide if you now have enough information\", \"continue the process\", \"structure a well-defined business problem statement\", \"your response should only include the final business problem statement\", \"based on the entire conversation.*final business problem statement\"];\n    return !hiddenPhrases.some(phrase => content.includes(phrase.replace(/\\.\\*/g, '')));\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: styles.conversationPageWrapper,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.chatWindow,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.header,\n        children: /*#__PURE__*/_jsxDEV(\"h1\", {\n          children: [pipelineStatus === 'initializing' && 'Initializing...', pipelineStatus === 'conversation' && !isFinal && 'Defining the Business Problem...', isFinal && pipelineStatus === 'conversation_complete' && 'Business Problem Defined', pipelineStatus.startsWith('processing_') && 'Processing Pipeline...', pipelineStatus === 'complete' && 'Processing Complete', pipelineStatus === 'error' && 'Error Occurred']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 298,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 297,\n        columnNumber: 9\n      }, this), isFinal && pipelineStatus !== 'conversation' ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.finalProblemDisplay,\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Final Business Problem:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 310,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: styles.finalProblemText,\n          children: finalProblemText\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 13\n        }, this), (isLoading || pipelineStatus.startsWith('processing_') || pipelineStatus === 'conversation_complete') && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.pipelineMessage,\n          children: [\"\\u23F3 \", pipelineMessage || 'Starting Pipeline...']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 313,\n          columnNumber: 18\n        }, this), pipelineStatus === 'complete' && !isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.pipelineMessage,\n          children: [\"\\u2705 \", pipelineMessage]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 17\n        }, this), pipelineStatus === 'error' && !isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `${styles.pipelineMessage} ${styles.errorMessage}`,\n          children: [\"\\u274C \", pipelineMessage]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 319,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 309,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.conversation,\n          children: [conversation.map((msg, idx) => {\n            const isUser = msg.startsWith('User:');\n            const isSystemOrAI = msg.startsWith('System:') || msg.startsWith('AI:');\n            const prefix = isUser ? 'User:' : msg.startsWith('AI:') ? 'AI:' : 'System:';\n            const bubbleClass = isUser ? styles.userBubble : styles.aiBubble;\n            const cleanedMsg = cleanMessage(msg, prefix);\n            const display = isUser || isSystemOrAI && shouldDisplaySystemMessage(msg);\n            if (cleanedMsg && display) {\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                className: bubbleClass,\n                children: /*#__PURE__*/_jsxDEV(\"p\", {\n                  style: {\n                    whiteSpace: 'pre-wrap'\n                  },\n                  children: cleanedMsg\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 336,\n                  columnNumber: 27\n                }, this)\n              }, idx, false, {\n                fileName: _jsxFileName,\n                lineNumber: 335,\n                columnNumber: 25\n              }, this);\n            }\n            return null;\n          }), isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: styles.loadingIndicator,\n            children: /*#__PURE__*/_jsxDEV(\"p\", {\n              children: pipelineMessage || 'Thinking...'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 345,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 344,\n            columnNumber: 17\n          }, this), pipelineStatus === 'error' && !isLoading && !isFinal && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `${styles.pipelineMessage} ${styles.errorMessage}`,\n            children: [\"\\u274C \", pipelineMessage]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 349,\n            columnNumber: 19\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            ref: conversationEndRef\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 351,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 324,\n          columnNumber: 13\n        }, this), pipelineStatus === 'conversation' && !isFinal && /*#__PURE__*/_jsxDEV(\"form\", {\n          className: styles.responseForm,\n          onSubmit: handleSubmit,\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"Type your answer here...\",\n            value: userResponse,\n            onChange: e => setUserResponse(e.target.value),\n            required: true,\n            disabled: isLoading\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 356,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            className: styles.submitButton,\n            disabled: isLoading || !userResponse.trim(),\n            children: isLoading ? 'Sending...' : 'Send'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 364,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 355,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 296,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 295,\n    columnNumber: 5\n  }, this);\n}\n_s(Conversation, \"/UXF0K4RY/xRGBLBHn0caeuyd0k=\", false, function () {\n  return [useLocation];\n});\n_c = Conversation;\nvar _c;\n$RefreshReg$(_c, \"Conversation\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useLocation","styles","callApi","jsxDEV","_jsxDEV","Fragment","_Fragment","BACKEND_SYSTEM_PROMPT_INITIAL_CORE","trim","toLowerCase","BACKEND_SYSTEM_PROMPT_NEXT_ITERATION_CORE","Conversation","_s","state","conversation","setConversation","userResponse","setUserResponse","isFinal","setIsFinal","finalProblemText","setFinalProblemText","isLoading","setIsLoading","pipelineStatus","setPipelineStatus","pipelineMessage","setPipelineMessage","conversationEndRef","processAndSetConversation","convoData","finalProblemData","filteredConvo","filter","msg","startsWith","indexOf","length","locationState","initialConvoFromState","initialFinalProblemFromState","final_problem","then","data","console","error","catch","err","message","finally","_conversationEndRef$c","current","scrollIntoView","behavior","runPipelineStep","step","_resultData","_resultData2","_resultData3","_resultData4","_resultData5","_resultData6","_resultData7","_resultData8","_resultData9","_resultData10","_resultData11","_resultData12","_resultData13","_resultData14","_resultData15","nextStep","success","errorMessage","apiEndpoint","apiMethod","resultData","status","details","warn","replace","timer","setTimeout","clearTimeout","handleSubmit","e","preventDefault","answer","currentConvoSnapshot","updatedConvoUI","user_response","newConvo","cleanMessage","prefixToRemove","cleaned","substring","shouldDisplaySystemMessage","cleanedMsg","content","hiddenPhrases","some","phrase","includes","className","conversationPageWrapper","children","chatWindow","header","fileName","_jsxFileName","lineNumber","columnNumber","finalProblemDisplay","map","idx","isUser","isSystemOrAI","prefix","bubbleClass","userBubble","aiBubble","display","style","whiteSpace","loadingIndicator","ref","responseForm","onSubmit","type","placeholder","value","onChange","target","required","disabled","submitButton","_c","$RefreshReg$"],"sources":["D:/AutoML/app/frontend/src/pages/Conversation.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport { useLocation } from 'react-router-dom';\r\nimport styles from './conversation_style.module.css';\r\nimport { callApi } from '../api/client'; // Ensure this points to your API client function\r\n\r\nconst BACKEND_SYSTEM_PROMPT_INITIAL_CORE = `\r\nYou are an AI assisting with business problem definition.\r\nThe user will provide a brief business problem statement.\r\nYour task is to:\r\n1. Analyze the user's problem statement.\r\n2. Decide if you need more information to understand the problem deeply enough to formulate a well-defined business problem statement.\r\n3. If you need more information, ask ONE clarifying question.  The question should be specific and help you understand a crucial aspect of the problem.\r\n4. If you believe you have enough information to formulate a problem statement, your response MUST START with the EXACT phrase: \"Ready to formulate problem.\" and nothing else before it. Do not ask a question in this case.\r\nYour response should follow one of these formats:\r\nFormat 1: Asking a Clarifying Question (if more info needed):\r\n<Your clarifying question>\r\nFormat 2: Ready to formulate problem (if enough info):\r\nReady to formulate problem.  (Your response MUST START with this EXACT phrase)\r\nExample:\r\nWhat specific metrics are you currently tracking to measure this problem?\r\nStart the process now.\r\n`.trim().toLowerCase();\r\n\r\nconst BACKEND_SYSTEM_PROMPT_NEXT_ITERATION_CORE = `\r\nYou are continuing to assist with business problem definition.\r\nThe user has responded to your previous question.\r\nYour task is to:\r\n1. Review the entire conversation so far, including the initial problem statement and the user's responses to your questions.\r\n2. Decide if you now have enough information to formulate a well-defined business problem statement.\r\n3. If you still need more information, ask ONE more clarifying question.\r\n4. If you believe you have enough information NOW to formulate a problem statement, your response MUST START with the EXACT phrase: \"Ready to formulate problem.\" and nothing else before it.\r\nYour response should follow one of these formats:\r\nFormat 1: Asking a Clarifying Question:\r\n<Your clarifying question>\r\nFormat 2: Ready to formulate problem:\r\nReady to formulate problem. (Your response MUST START with this EXACT phrase)\r\nContinue the process.\r\n`.trim().toLowerCase();\r\n\r\n\r\nexport default function Conversation() {\r\n  const { state } = useLocation();\r\n  const [conversation, setConversation] = useState([]);\r\n  const [userResponse, setUserResponse] = useState('');\r\n  const [isFinal, setIsFinal] = useState(false);\r\n  const [finalProblemText, setFinalProblemText] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false); // Combined loading state\r\n  const [pipelineStatus, setPipelineStatus] = useState('idle');\r\n  const [pipelineMessage, setPipelineMessage] = useState('');\r\n  const conversationEndRef = useRef(null);\r\n\r\n  // Helper function to filter and set conversation state\r\n  const processAndSetConversation = (convoData, finalProblemData) => {\r\n    const filteredConvo = (convoData || []).filter(msg =>\r\n        !msg.startsWith('FileDetails:') &&\r\n        !(msg.startsWith('User:') && (convoData || []).indexOf(msg) === 0)\r\n    );\r\n    setConversation(filteredConvo);\r\n\r\n    if (finalProblemData) {\r\n        setFinalProblemText(finalProblemData);\r\n        setIsFinal(true);\r\n        setPipelineStatus('conversation_complete'); // Ready to start pipeline\r\n    } else if (filteredConvo.length > 0) {\r\n        setPipelineStatus('conversation'); // Still in conversation phase\r\n    } else {\r\n        // Handle case where convo is empty and no final problem\r\n        setPipelineStatus('error');\r\n        setPipelineMessage('Conversation initialization failed or empty.');\r\n    }\r\n  };\r\n\r\n  // --- Effect 1: Initial Load and Server Sync ---\r\n  useEffect(() => {\r\n    const locationState = state;\r\n    let initialConvoFromState = [];\r\n    let initialFinalProblemFromState = null;\r\n\r\n    if (locationState) {\r\n        initialConvoFromState = locationState.conversation || [];\r\n        initialFinalProblemFromState = locationState.final_problem || null;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setPipelineStatus('initializing');\r\n    setPipelineMessage('Initializing conversation...');\r\n\r\n    if (initialFinalProblemFromState) {\r\n        processAndSetConversation(initialConvoFromState, initialFinalProblemFromState);\r\n        setIsLoading(false);\r\n        setPipelineMessage('');\r\n    } else {\r\n        callApi('conversation', 'GET')\r\n            .then(data => {\r\n                if (data && data.conversation) {\r\n                    processAndSetConversation(data.conversation, data.final_problem);\r\n                } else {\r\n                     console.error(\"GET /api/conversation response missing data:\", data);\r\n                     setPipelineStatus('error');\r\n                     setPipelineMessage('Failed to get initial conversation state from server.');\r\n                }\r\n            })\r\n            .catch(err => {\r\n                console.error(\"Initial GET /api/conversation failed:\", err);\r\n                setPipelineStatus('error');\r\n                setPipelineMessage(`Failed to connect: ${err.message || 'Network error'}`);\r\n            })\r\n            .finally(() => {\r\n                setIsLoading(false);\r\n                 if (pipelineStatus !== 'error') {\r\n                     setPipelineMessage('');\r\n                 }\r\n            });\r\n    }\r\n  }, [state]); // Dependency array for initial load\r\n\r\n\r\n  // --- Effect 2: Scroll Conversation ---\r\n  useEffect(() => {\r\n    if (pipelineStatus === 'conversation' || pipelineStatus === 'initializing') {\r\n       conversationEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n    }\r\n  }, [conversation, pipelineStatus, isLoading]);\r\n\r\n\r\n  // --- Effect 3: Trigger Pipeline Steps ---\r\n  useEffect(() => {\r\n    const runPipelineStep = async (step) => {\r\n      let nextStep = '';\r\n      let success = false;\r\n      let errorMessage = '';\r\n      let apiEndpoint = '';\r\n      let apiMethod = 'POST';\r\n      let resultData = null;\r\n\r\n      setIsLoading(true);\r\n\r\n      try {\r\n        switch (step) {\r\n          case 'processing_eda':\r\n            setPipelineMessage('Generating & Running EDA...');\r\n            apiEndpoint = 'dataanalysis';\r\n            resultData = await callApi(apiEndpoint, apiMethod);\r\n            success = resultData?.status === 'success';\r\n            if (!success) errorMessage = resultData?.error || resultData?.details || 'EDA execution failed.';\r\n            else nextStep = 'processing_plan';\r\n            break;\r\n\r\n          case 'processing_plan':\r\n             setPipelineMessage('Generating ML Plan...');\r\n             apiEndpoint = 'superllm';\r\n             resultData = await callApi(apiEndpoint, apiMethod);\r\n             success = resultData?.status === 'plan_generated';\r\n             if (!success) errorMessage = resultData?.error || resultData?.details || 'ML plan generation failed.';\r\n             else nextStep = 'processing_ml';\r\n            break;\r\n\r\n          case 'processing_ml':\r\n             setPipelineMessage('Generating & Running ML Code...');\r\n             apiEndpoint = 'ml';\r\n             resultData = await callApi(apiEndpoint, apiMethod);\r\n             success = resultData?.status === 'success';\r\n             if (!success) errorMessage = resultData?.error || resultData?.details || 'ML execution failed.';\r\n             else nextStep = 'processing_viz_plan';\r\n            break;\r\n\r\n          case 'processing_viz_plan':\r\n             setPipelineMessage('Generating Visualization Plan...');\r\n             apiEndpoint = 'visualizationplanning';\r\n             resultData = await callApi(apiEndpoint, apiMethod);\r\n             success = resultData?.status === 'plan_generated';\r\n             if (!success) errorMessage = resultData?.error || resultData?.details || 'Visualization plan generation failed.';\r\n             else nextStep = 'processing_viz';\r\n            break;\r\n\r\n          case 'processing_viz':\r\n             setPipelineMessage('Generating & Running Visualizations...');\r\n             apiEndpoint = 'visualizations';\r\n             resultData = await callApi(apiEndpoint, apiMethod);\r\n             success = resultData?.status === 'success';\r\n             if (!success) errorMessage = resultData?.error || resultData?.message || 'Visualization execution failed.';\r\n             else nextStep = 'complete';\r\n            break;\r\n\r\n          default:\r\n            console.warn(\"Unknown pipeline step:\", step);\r\n            setIsLoading(false);\r\n            return;\r\n        }\r\n\r\n        if (success) {\r\n          setPipelineStatus(nextStep);\r\n        } else {\r\n          setPipelineStatus('error');\r\n          setPipelineMessage(`Error during ${step.replace('processing_', '')}: ${errorMessage}`);\r\n        }\r\n\r\n      } catch (err) {\r\n        console.error(`API call failed for ${step} (${apiEndpoint}):`, err);\r\n        setPipelineStatus('error');\r\n        setPipelineMessage(`Error during ${step.replace('processing_', '')}: ${err.message || 'Network or API error'}`);\r\n      } finally {\r\n          if (!success || nextStep === 'complete') {\r\n             setIsLoading(false);\r\n          }\r\n      }\r\n    };\r\n\r\n    if (pipelineStatus === 'conversation_complete') {\r\n      const timer = setTimeout(() => {\r\n         setPipelineStatus('processing_eda');\r\n      }, 500);\r\n      return () => clearTimeout(timer);\r\n    } else if (pipelineStatus.startsWith('processing_')) {\r\n      runPipelineStep(pipelineStatus);\r\n    } else if (pipelineStatus === 'complete') {\r\n        setPipelineMessage('Processing Complete! Visualizations generated.');\r\n        setIsLoading(false);\r\n    } else if (pipelineStatus === 'error') {\r\n        setIsLoading(false);\r\n    }\r\n\r\n  }, [pipelineStatus]); // Dependency array for pipeline\r\n\r\n\r\n  // --- Handle User Submission ---\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!userResponse.trim() || isLoading || isFinal || pipelineStatus !== 'conversation') return;\r\n\r\n    const answer = userResponse.trim();\r\n    const currentConvoSnapshot = [...conversation];\r\n    const updatedConvoUI = [...currentConvoSnapshot, `User: ${answer}`];\r\n    setConversation(updatedConvoUI);\r\n    setUserResponse('');\r\n    setIsLoading(true);\r\n    setPipelineMessage('');\r\n\r\n    try {\r\n      const data = await callApi('conversation', 'POST', { user_response: answer });\r\n\r\n      const newConvo = data.conversation || [];\r\n      const finalProblemData = data.final_problem || null;\r\n\r\n      processAndSetConversation(newConvo, finalProblemData);\r\n\r\n    } catch (err) {\r\n      console.error('API call failed:', err);\r\n      setConversation(currentConvoSnapshot);\r\n      setUserResponse(answer);\r\n      setPipelineStatus('error');\r\n      setPipelineMessage(`Failed to get response: ${err.message || 'API error'}`);\r\n    } finally {\r\n      if (!isFinal) { // Use the updated isFinal state here\r\n          setIsLoading(false);\r\n      }\r\n    }\r\n  };\r\n\r\n  // Helper to clean messages\r\n  const cleanMessage = (msg, prefixToRemove) => {\r\n    let cleaned = msg.startsWith(prefixToRemove)\r\n      ? msg.substring(prefixToRemove.length).trim()\r\n      : msg.trim();\r\n    cleaned = cleaned.replace(/^question\\s*\\d+\\)\\s*/i, '').trim();\r\n    cleaned = cleaned.replace(/^ai:\\s*/i, '').trim();\r\n    return cleaned;\r\n  };\r\n\r\n  // Filter system messages\r\n  const shouldDisplaySystemMessage = (msg) => {\r\n    if (!msg.startsWith('System:')) return true;\r\n\r\n    const cleanedMsg = msg.substring('System:'.length).trim();\r\n    const content = cleanedMsg.toLowerCase();\r\n\r\n    if (content === BACKEND_SYSTEM_PROMPT_INITIAL_CORE ||\r\n        content === BACKEND_SYSTEM_PROMPT_NEXT_ITERATION_CORE) {\r\n        return false;\r\n    }\r\n\r\n    const hiddenPhrases = [\r\n        \"you are \", \"your task is\", \"format 1:\", \"format 2:\",\r\n        \"decide if you now have enough information\", \"continue the process\",\r\n        \"structure a well-defined business problem statement\",\r\n        \"your response should only include the final business problem statement\",\r\n        \"based on the entire conversation.*final business problem statement\"\r\n    ];\r\n\r\n    return !hiddenPhrases.some(phrase => content.includes(phrase.replace(/\\.\\*/g, '')));\r\n  };\r\n\r\n\r\n  return (\r\n    <div className={styles.conversationPageWrapper}>\r\n      <div className={styles.chatWindow}>\r\n        <div className={styles.header}>\r\n          <h1>\r\n            {pipelineStatus === 'initializing' && 'Initializing...'}\r\n            {pipelineStatus === 'conversation' && !isFinal && 'Defining the Business Problem...'}\r\n            {isFinal && pipelineStatus === 'conversation_complete' && 'Business Problem Defined'}\r\n            {pipelineStatus.startsWith('processing_') && 'Processing Pipeline...'}\r\n            {pipelineStatus === 'complete' && 'Processing Complete'}\r\n            {pipelineStatus === 'error' && 'Error Occurred'}\r\n          </h1>\r\n        </div>\r\n\r\n        {isFinal && pipelineStatus !== 'conversation' ? (\r\n          <div className={styles.finalProblemDisplay}>\r\n            <h2>Final Business Problem:</h2>\r\n            <p className={styles.finalProblemText}>{finalProblemText}</p>\r\n            {(isLoading || pipelineStatus.startsWith('processing_') || pipelineStatus === 'conversation_complete') && (\r\n                 <div className={styles.pipelineMessage}>⏳ {pipelineMessage || 'Starting Pipeline...'}</div>\r\n            )}\r\n            {pipelineStatus === 'complete' && !isLoading && (\r\n                <div className={styles.pipelineMessage}>✅ {pipelineMessage}</div>\r\n            )}\r\n             {pipelineStatus === 'error' && !isLoading && (\r\n                <div className={`${styles.pipelineMessage} ${styles.errorMessage}`}>❌ {pipelineMessage}</div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <>\r\n            <div className={styles.conversation}>\r\n              {conversation.map((msg, idx) => {\r\n                 const isUser = msg.startsWith('User:');\r\n                 const isSystemOrAI = msg.startsWith('System:') || msg.startsWith('AI:');\r\n                 const prefix = isUser ? 'User:' : (msg.startsWith('AI:') ? 'AI:' : 'System:');\r\n                 const bubbleClass = isUser ? styles.userBubble : styles.aiBubble;\r\n                 const cleanedMsg = cleanMessage(msg, prefix);\r\n                 const display = isUser || (isSystemOrAI && shouldDisplaySystemMessage(msg));\r\n\r\n                 if (cleanedMsg && display) {\r\n                     return (\r\n                        <div key={idx} className={bubbleClass}>\r\n                          <p style={{ whiteSpace: 'pre-wrap' }}>{cleanedMsg}</p>\r\n                        </div>\r\n                     );\r\n                 }\r\n                 return null;\r\n              })}\r\n\r\n              {isLoading && (\r\n                <div className={styles.loadingIndicator}>\r\n                  <p>{pipelineMessage || 'Thinking...'}</p>\r\n                </div>\r\n              )}\r\n               {pipelineStatus === 'error' && !isLoading && !isFinal && (\r\n                  <div className={`${styles.pipelineMessage} ${styles.errorMessage}`}>❌ {pipelineMessage}</div>\r\n              )}\r\n              <div ref={conversationEndRef} />\r\n            </div>\r\n\r\n            {pipelineStatus === 'conversation' && !isFinal && (\r\n              <form className={styles.responseForm} onSubmit={handleSubmit}>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Type your answer here...\"\r\n                  value={userResponse}\r\n                  onChange={e => setUserResponse(e.target.value)}\r\n                  required\r\n                  disabled={isLoading}\r\n                />\r\n                <button\r\n                  type=\"submit\"\r\n                  className={styles.submitButton}\r\n                  disabled={isLoading || !userResponse.trim()}\r\n                >\r\n                  {isLoading ? 'Sending...' : 'Send'}\r\n                </button>\r\n              </form>\r\n            )}\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,OAAO;AAC1D,SAASC,WAAW,QAAQ,kBAAkB;AAC9C,OAAOC,MAAM,MAAM,iCAAiC;AACpD,SAASC,OAAO,QAAQ,eAAe,CAAC,CAAC;AAAA,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAEzC,MAAMC,kCAAkC,GAAG;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAACC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;AAEtB,MAAMC,yCAAyC,GAAG;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAACF,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;AAGtB,eAAe,SAASE,YAAYA,CAAA,EAAG;EAAAC,EAAA;EACrC,MAAM;IAAEC;EAAM,CAAC,GAAGb,WAAW,CAAC,CAAC;EAC/B,MAAM,CAACc,YAAY,EAAEC,eAAe,CAAC,GAAGhB,QAAQ,CAAC,EAAE,CAAC;EACpD,MAAM,CAACiB,YAAY,EAAEC,eAAe,CAAC,GAAGlB,QAAQ,CAAC,EAAE,CAAC;EACpD,MAAM,CAACmB,OAAO,EAAEC,UAAU,CAAC,GAAGpB,QAAQ,CAAC,KAAK,CAAC;EAC7C,MAAM,CAACqB,gBAAgB,EAAEC,mBAAmB,CAAC,GAAGtB,QAAQ,CAAC,EAAE,CAAC;EAC5D,MAAM,CAACuB,SAAS,EAAEC,YAAY,CAAC,GAAGxB,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;EACnD,MAAM,CAACyB,cAAc,EAAEC,iBAAiB,CAAC,GAAG1B,QAAQ,CAAC,MAAM,CAAC;EAC5D,MAAM,CAAC2B,eAAe,EAAEC,kBAAkB,CAAC,GAAG5B,QAAQ,CAAC,EAAE,CAAC;EAC1D,MAAM6B,kBAAkB,GAAG9B,MAAM,CAAC,IAAI,CAAC;;EAEvC;EACA,MAAM+B,yBAAyB,GAAGA,CAACC,SAAS,EAAEC,gBAAgB,KAAK;IACjE,MAAMC,aAAa,GAAG,CAACF,SAAS,IAAI,EAAE,EAAEG,MAAM,CAACC,GAAG,IAC9C,CAACA,GAAG,CAACC,UAAU,CAAC,cAAc,CAAC,IAC/B,EAAED,GAAG,CAACC,UAAU,CAAC,OAAO,CAAC,IAAI,CAACL,SAAS,IAAI,EAAE,EAAEM,OAAO,CAACF,GAAG,CAAC,KAAK,CAAC,CACrE,CAAC;IACDnB,eAAe,CAACiB,aAAa,CAAC;IAE9B,IAAID,gBAAgB,EAAE;MAClBV,mBAAmB,CAACU,gBAAgB,CAAC;MACrCZ,UAAU,CAAC,IAAI,CAAC;MAChBM,iBAAiB,CAAC,uBAAuB,CAAC,CAAC,CAAC;IAChD,CAAC,MAAM,IAAIO,aAAa,CAACK,MAAM,GAAG,CAAC,EAAE;MACjCZ,iBAAiB,CAAC,cAAc,CAAC,CAAC,CAAC;IACvC,CAAC,MAAM;MACH;MACAA,iBAAiB,CAAC,OAAO,CAAC;MAC1BE,kBAAkB,CAAC,8CAA8C,CAAC;IACtE;EACF,CAAC;;EAED;EACA9B,SAAS,CAAC,MAAM;IACd,MAAMyC,aAAa,GAAGzB,KAAK;IAC3B,IAAI0B,qBAAqB,GAAG,EAAE;IAC9B,IAAIC,4BAA4B,GAAG,IAAI;IAEvC,IAAIF,aAAa,EAAE;MACfC,qBAAqB,GAAGD,aAAa,CAACxB,YAAY,IAAI,EAAE;MACxD0B,4BAA4B,GAAGF,aAAa,CAACG,aAAa,IAAI,IAAI;IACtE;IAEAlB,YAAY,CAAC,IAAI,CAAC;IAClBE,iBAAiB,CAAC,cAAc,CAAC;IACjCE,kBAAkB,CAAC,8BAA8B,CAAC;IAElD,IAAIa,4BAA4B,EAAE;MAC9BX,yBAAyB,CAACU,qBAAqB,EAAEC,4BAA4B,CAAC;MAC9EjB,YAAY,CAAC,KAAK,CAAC;MACnBI,kBAAkB,CAAC,EAAE,CAAC;IAC1B,CAAC,MAAM;MACHzB,OAAO,CAAC,cAAc,EAAE,KAAK,CAAC,CACzBwC,IAAI,CAACC,IAAI,IAAI;QACV,IAAIA,IAAI,IAAIA,IAAI,CAAC7B,YAAY,EAAE;UAC3Be,yBAAyB,CAACc,IAAI,CAAC7B,YAAY,EAAE6B,IAAI,CAACF,aAAa,CAAC;QACpE,CAAC,MAAM;UACFG,OAAO,CAACC,KAAK,CAAC,8CAA8C,EAAEF,IAAI,CAAC;UACnElB,iBAAiB,CAAC,OAAO,CAAC;UAC1BE,kBAAkB,CAAC,uDAAuD,CAAC;QAChF;MACJ,CAAC,CAAC,CACDmB,KAAK,CAACC,GAAG,IAAI;QACVH,OAAO,CAACC,KAAK,CAAC,uCAAuC,EAAEE,GAAG,CAAC;QAC3DtB,iBAAiB,CAAC,OAAO,CAAC;QAC1BE,kBAAkB,CAAC,sBAAsBoB,GAAG,CAACC,OAAO,IAAI,eAAe,EAAE,CAAC;MAC9E,CAAC,CAAC,CACDC,OAAO,CAAC,MAAM;QACX1B,YAAY,CAAC,KAAK,CAAC;QAClB,IAAIC,cAAc,KAAK,OAAO,EAAE;UAC5BG,kBAAkB,CAAC,EAAE,CAAC;QAC1B;MACL,CAAC,CAAC;IACV;EACF,CAAC,EAAE,CAACd,KAAK,CAAC,CAAC,CAAC,CAAC;;EAGb;EACAhB,SAAS,CAAC,MAAM;IACd,IAAI2B,cAAc,KAAK,cAAc,IAAIA,cAAc,KAAK,cAAc,EAAE;MAAA,IAAA0B,qBAAA;MACzE,CAAAA,qBAAA,GAAAtB,kBAAkB,CAACuB,OAAO,cAAAD,qBAAA,uBAA1BA,qBAAA,CAA4BE,cAAc,CAAC;QAAEC,QAAQ,EAAE;MAAS,CAAC,CAAC;IACrE;EACF,CAAC,EAAE,CAACvC,YAAY,EAAEU,cAAc,EAAEF,SAAS,CAAC,CAAC;;EAG7C;EACAzB,SAAS,CAAC,MAAM;IACd,MAAMyD,eAAe,GAAG,MAAOC,IAAI,IAAK;MAAA,IAAAC,WAAA,EAAAC,YAAA,EAAAC,YAAA,EAAAC,YAAA,EAAAC,YAAA,EAAAC,YAAA,EAAAC,YAAA,EAAAC,YAAA,EAAAC,YAAA,EAAAC,aAAA,EAAAC,aAAA,EAAAC,aAAA,EAAAC,aAAA,EAAAC,aAAA,EAAAC,aAAA;MACtC,IAAIC,QAAQ,GAAG,EAAE;MACjB,IAAIC,OAAO,GAAG,KAAK;MACnB,IAAIC,YAAY,GAAG,EAAE;MACrB,IAAIC,WAAW,GAAG,EAAE;MACpB,IAAIC,SAAS,GAAG,MAAM;MACtB,IAAIC,UAAU,GAAG,IAAI;MAErBrD,YAAY,CAAC,IAAI,CAAC;MAElB,IAAI;QACF,QAAQgC,IAAI;UACV,KAAK,gBAAgB;YACnB5B,kBAAkB,CAAC,6BAA6B,CAAC;YACjD+C,WAAW,GAAG,cAAc;YAC5BE,UAAU,GAAG,MAAM1E,OAAO,CAACwE,WAAW,EAAEC,SAAS,CAAC;YAClDH,OAAO,GAAG,EAAAhB,WAAA,GAAAoB,UAAU,cAAApB,WAAA,uBAAVA,WAAA,CAAYqB,MAAM,MAAK,SAAS;YAC1C,IAAI,CAACL,OAAO,EAAEC,YAAY,GAAG,EAAAhB,YAAA,GAAAmB,UAAU,cAAAnB,YAAA,uBAAVA,YAAA,CAAYZ,KAAK,OAAAa,YAAA,GAAIkB,UAAU,cAAAlB,YAAA,uBAAVA,YAAA,CAAYoB,OAAO,KAAI,uBAAuB,CAAC,KAC5FP,QAAQ,GAAG,iBAAiB;YACjC;UAEF,KAAK,iBAAiB;YACnB5C,kBAAkB,CAAC,uBAAuB,CAAC;YAC3C+C,WAAW,GAAG,UAAU;YACxBE,UAAU,GAAG,MAAM1E,OAAO,CAACwE,WAAW,EAAEC,SAAS,CAAC;YAClDH,OAAO,GAAG,EAAAb,YAAA,GAAAiB,UAAU,cAAAjB,YAAA,uBAAVA,YAAA,CAAYkB,MAAM,MAAK,gBAAgB;YACjD,IAAI,CAACL,OAAO,EAAEC,YAAY,GAAG,EAAAb,YAAA,GAAAgB,UAAU,cAAAhB,YAAA,uBAAVA,YAAA,CAAYf,KAAK,OAAAgB,YAAA,GAAIe,UAAU,cAAAf,YAAA,uBAAVA,YAAA,CAAYiB,OAAO,KAAI,4BAA4B,CAAC,KACjGP,QAAQ,GAAG,eAAe;YAChC;UAEF,KAAK,eAAe;YACjB5C,kBAAkB,CAAC,iCAAiC,CAAC;YACrD+C,WAAW,GAAG,IAAI;YAClBE,UAAU,GAAG,MAAM1E,OAAO,CAACwE,WAAW,EAAEC,SAAS,CAAC;YAClDH,OAAO,GAAG,EAAAV,YAAA,GAAAc,UAAU,cAAAd,YAAA,uBAAVA,YAAA,CAAYe,MAAM,MAAK,SAAS;YAC1C,IAAI,CAACL,OAAO,EAAEC,YAAY,GAAG,EAAAV,YAAA,GAAAa,UAAU,cAAAb,YAAA,uBAAVA,YAAA,CAAYlB,KAAK,OAAAmB,YAAA,GAAIY,UAAU,cAAAZ,YAAA,uBAAVA,YAAA,CAAYc,OAAO,KAAI,sBAAsB,CAAC,KAC3FP,QAAQ,GAAG,qBAAqB;YACtC;UAEF,KAAK,qBAAqB;YACvB5C,kBAAkB,CAAC,kCAAkC,CAAC;YACtD+C,WAAW,GAAG,uBAAuB;YACrCE,UAAU,GAAG,MAAM1E,OAAO,CAACwE,WAAW,EAAEC,SAAS,CAAC;YAClDH,OAAO,GAAG,EAAAP,aAAA,GAAAW,UAAU,cAAAX,aAAA,uBAAVA,aAAA,CAAYY,MAAM,MAAK,gBAAgB;YACjD,IAAI,CAACL,OAAO,EAAEC,YAAY,GAAG,EAAAP,aAAA,GAAAU,UAAU,cAAAV,aAAA,uBAAVA,aAAA,CAAYrB,KAAK,OAAAsB,aAAA,GAAIS,UAAU,cAAAT,aAAA,uBAAVA,aAAA,CAAYW,OAAO,KAAI,uCAAuC,CAAC,KAC5GP,QAAQ,GAAG,gBAAgB;YACjC;UAEF,KAAK,gBAAgB;YAClB5C,kBAAkB,CAAC,wCAAwC,CAAC;YAC5D+C,WAAW,GAAG,gBAAgB;YAC9BE,UAAU,GAAG,MAAM1E,OAAO,CAACwE,WAAW,EAAEC,SAAS,CAAC;YAClDH,OAAO,GAAG,EAAAJ,aAAA,GAAAQ,UAAU,cAAAR,aAAA,uBAAVA,aAAA,CAAYS,MAAM,MAAK,SAAS;YAC1C,IAAI,CAACL,OAAO,EAAEC,YAAY,GAAG,EAAAJ,aAAA,GAAAO,UAAU,cAAAP,aAAA,uBAAVA,aAAA,CAAYxB,KAAK,OAAAyB,aAAA,GAAIM,UAAU,cAAAN,aAAA,uBAAVA,aAAA,CAAYtB,OAAO,KAAI,iCAAiC,CAAC,KACtGuB,QAAQ,GAAG,UAAU;YAC3B;UAEF;YACE3B,OAAO,CAACmC,IAAI,CAAC,wBAAwB,EAAExB,IAAI,CAAC;YAC5ChC,YAAY,CAAC,KAAK,CAAC;YACnB;QACJ;QAEA,IAAIiD,OAAO,EAAE;UACX/C,iBAAiB,CAAC8C,QAAQ,CAAC;QAC7B,CAAC,MAAM;UACL9C,iBAAiB,CAAC,OAAO,CAAC;UAC1BE,kBAAkB,CAAC,gBAAgB4B,IAAI,CAACyB,OAAO,CAAC,aAAa,EAAE,EAAE,CAAC,KAAKP,YAAY,EAAE,CAAC;QACxF;MAEF,CAAC,CAAC,OAAO1B,GAAG,EAAE;QACZH,OAAO,CAACC,KAAK,CAAC,uBAAuBU,IAAI,KAAKmB,WAAW,IAAI,EAAE3B,GAAG,CAAC;QACnEtB,iBAAiB,CAAC,OAAO,CAAC;QAC1BE,kBAAkB,CAAC,gBAAgB4B,IAAI,CAACyB,OAAO,CAAC,aAAa,EAAE,EAAE,CAAC,KAAKjC,GAAG,CAACC,OAAO,IAAI,sBAAsB,EAAE,CAAC;MACjH,CAAC,SAAS;QACN,IAAI,CAACwB,OAAO,IAAID,QAAQ,KAAK,UAAU,EAAE;UACtChD,YAAY,CAAC,KAAK,CAAC;QACtB;MACJ;IACF,CAAC;IAED,IAAIC,cAAc,KAAK,uBAAuB,EAAE;MAC9C,MAAMyD,KAAK,GAAGC,UAAU,CAAC,MAAM;QAC5BzD,iBAAiB,CAAC,gBAAgB,CAAC;MACtC,CAAC,EAAE,GAAG,CAAC;MACP,OAAO,MAAM0D,YAAY,CAACF,KAAK,CAAC;IAClC,CAAC,MAAM,IAAIzD,cAAc,CAACW,UAAU,CAAC,aAAa,CAAC,EAAE;MACnDmB,eAAe,CAAC9B,cAAc,CAAC;IACjC,CAAC,MAAM,IAAIA,cAAc,KAAK,UAAU,EAAE;MACtCG,kBAAkB,CAAC,gDAAgD,CAAC;MACpEJ,YAAY,CAAC,KAAK,CAAC;IACvB,CAAC,MAAM,IAAIC,cAAc,KAAK,OAAO,EAAE;MACnCD,YAAY,CAAC,KAAK,CAAC;IACvB;EAEF,CAAC,EAAE,CAACC,cAAc,CAAC,CAAC,CAAC,CAAC;;EAGtB;EACA,MAAM4D,YAAY,GAAG,MAAOC,CAAC,IAAK;IAChCA,CAAC,CAACC,cAAc,CAAC,CAAC;IAClB,IAAI,CAACtE,YAAY,CAACR,IAAI,CAAC,CAAC,IAAIc,SAAS,IAAIJ,OAAO,IAAIM,cAAc,KAAK,cAAc,EAAE;IAEvF,MAAM+D,MAAM,GAAGvE,YAAY,CAACR,IAAI,CAAC,CAAC;IAClC,MAAMgF,oBAAoB,GAAG,CAAC,GAAG1E,YAAY,CAAC;IAC9C,MAAM2E,cAAc,GAAG,CAAC,GAAGD,oBAAoB,EAAE,SAASD,MAAM,EAAE,CAAC;IACnExE,eAAe,CAAC0E,cAAc,CAAC;IAC/BxE,eAAe,CAAC,EAAE,CAAC;IACnBM,YAAY,CAAC,IAAI,CAAC;IAClBI,kBAAkB,CAAC,EAAE,CAAC;IAEtB,IAAI;MACF,MAAMgB,IAAI,GAAG,MAAMzC,OAAO,CAAC,cAAc,EAAE,MAAM,EAAE;QAAEwF,aAAa,EAAEH;MAAO,CAAC,CAAC;MAE7E,MAAMI,QAAQ,GAAGhD,IAAI,CAAC7B,YAAY,IAAI,EAAE;MACxC,MAAMiB,gBAAgB,GAAGY,IAAI,CAACF,aAAa,IAAI,IAAI;MAEnDZ,yBAAyB,CAAC8D,QAAQ,EAAE5D,gBAAgB,CAAC;IAEvD,CAAC,CAAC,OAAOgB,GAAG,EAAE;MACZH,OAAO,CAACC,KAAK,CAAC,kBAAkB,EAAEE,GAAG,CAAC;MACtChC,eAAe,CAACyE,oBAAoB,CAAC;MACrCvE,eAAe,CAACsE,MAAM,CAAC;MACvB9D,iBAAiB,CAAC,OAAO,CAAC;MAC1BE,kBAAkB,CAAC,2BAA2BoB,GAAG,CAACC,OAAO,IAAI,WAAW,EAAE,CAAC;IAC7E,CAAC,SAAS;MACR,IAAI,CAAC9B,OAAO,EAAE;QAAE;QACZK,YAAY,CAAC,KAAK,CAAC;MACvB;IACF;EACF,CAAC;;EAED;EACA,MAAMqE,YAAY,GAAGA,CAAC1D,GAAG,EAAE2D,cAAc,KAAK;IAC5C,IAAIC,OAAO,GAAG5D,GAAG,CAACC,UAAU,CAAC0D,cAAc,CAAC,GACxC3D,GAAG,CAAC6D,SAAS,CAACF,cAAc,CAACxD,MAAM,CAAC,CAAC7B,IAAI,CAAC,CAAC,GAC3C0B,GAAG,CAAC1B,IAAI,CAAC,CAAC;IACdsF,OAAO,GAAGA,OAAO,CAACd,OAAO,CAAC,uBAAuB,EAAE,EAAE,CAAC,CAACxE,IAAI,CAAC,CAAC;IAC7DsF,OAAO,GAAGA,OAAO,CAACd,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAACxE,IAAI,CAAC,CAAC;IAChD,OAAOsF,OAAO;EAChB,CAAC;;EAED;EACA,MAAME,0BAA0B,GAAI9D,GAAG,IAAK;IAC1C,IAAI,CAACA,GAAG,CAACC,UAAU,CAAC,SAAS,CAAC,EAAE,OAAO,IAAI;IAE3C,MAAM8D,UAAU,GAAG/D,GAAG,CAAC6D,SAAS,CAAC,SAAS,CAAC1D,MAAM,CAAC,CAAC7B,IAAI,CAAC,CAAC;IACzD,MAAM0F,OAAO,GAAGD,UAAU,CAACxF,WAAW,CAAC,CAAC;IAExC,IAAIyF,OAAO,KAAK3F,kCAAkC,IAC9C2F,OAAO,KAAKxF,yCAAyC,EAAE;MACvD,OAAO,KAAK;IAChB;IAEA,MAAMyF,aAAa,GAAG,CAClB,UAAU,EAAE,cAAc,EAAE,WAAW,EAAE,WAAW,EACpD,2CAA2C,EAAE,sBAAsB,EACnE,qDAAqD,EACrD,wEAAwE,EACxE,oEAAoE,CACvE;IAED,OAAO,CAACA,aAAa,CAACC,IAAI,CAACC,MAAM,IAAIH,OAAO,CAACI,QAAQ,CAACD,MAAM,CAACrB,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,CAAC;EACrF,CAAC;EAGD,oBACE5E,OAAA;IAAKmG,SAAS,EAAEtG,MAAM,CAACuG,uBAAwB;IAAAC,QAAA,eAC7CrG,OAAA;MAAKmG,SAAS,EAAEtG,MAAM,CAACyG,UAAW;MAAAD,QAAA,gBAChCrG,OAAA;QAAKmG,SAAS,EAAEtG,MAAM,CAAC0G,MAAO;QAAAF,QAAA,eAC5BrG,OAAA;UAAAqG,QAAA,GACGjF,cAAc,KAAK,cAAc,IAAI,iBAAiB,EACtDA,cAAc,KAAK,cAAc,IAAI,CAACN,OAAO,IAAI,kCAAkC,EACnFA,OAAO,IAAIM,cAAc,KAAK,uBAAuB,IAAI,0BAA0B,EACnFA,cAAc,CAACW,UAAU,CAAC,aAAa,CAAC,IAAI,wBAAwB,EACpEX,cAAc,KAAK,UAAU,IAAI,qBAAqB,EACtDA,cAAc,KAAK,OAAO,IAAI,gBAAgB;QAAA;UAAAoF,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC7C;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACF,CAAC,EAEL7F,OAAO,IAAIM,cAAc,KAAK,cAAc,gBAC3CpB,OAAA;QAAKmG,SAAS,EAAEtG,MAAM,CAAC+G,mBAAoB;QAAAP,QAAA,gBACzCrG,OAAA;UAAAqG,QAAA,EAAI;QAAuB;UAAAG,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC,eAChC3G,OAAA;UAAGmG,SAAS,EAAEtG,MAAM,CAACmB,gBAAiB;UAAAqF,QAAA,EAAErF;QAAgB;UAAAwF,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC,EAC5D,CAACzF,SAAS,IAAIE,cAAc,CAACW,UAAU,CAAC,aAAa,CAAC,IAAIX,cAAc,KAAK,uBAAuB,kBAChGpB,OAAA;UAAKmG,SAAS,EAAEtG,MAAM,CAACyB,eAAgB;UAAA+E,QAAA,GAAC,SAAE,EAAC/E,eAAe,IAAI,sBAAsB;QAAA;UAAAkF,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAC9F,EACAvF,cAAc,KAAK,UAAU,IAAI,CAACF,SAAS,iBACxClB,OAAA;UAAKmG,SAAS,EAAEtG,MAAM,CAACyB,eAAgB;UAAA+E,QAAA,GAAC,SAAE,EAAC/E,eAAe;QAAA;UAAAkF,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CACnE,EACCvF,cAAc,KAAK,OAAO,IAAI,CAACF,SAAS,iBACtClB,OAAA;UAAKmG,SAAS,EAAE,GAAGtG,MAAM,CAACyB,eAAe,IAAIzB,MAAM,CAACwE,YAAY,EAAG;UAAAgC,QAAA,GAAC,SAAE,EAAC/E,eAAe;QAAA;UAAAkF,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAC/F;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACE,CAAC,gBAEN3G,OAAA,CAAAE,SAAA;QAAAmG,QAAA,gBACErG,OAAA;UAAKmG,SAAS,EAAEtG,MAAM,CAACa,YAAa;UAAA2F,QAAA,GACjC3F,YAAY,CAACmG,GAAG,CAAC,CAAC/E,GAAG,EAAEgF,GAAG,KAAK;YAC7B,MAAMC,MAAM,GAAGjF,GAAG,CAACC,UAAU,CAAC,OAAO,CAAC;YACtC,MAAMiF,YAAY,GAAGlF,GAAG,CAACC,UAAU,CAAC,SAAS,CAAC,IAAID,GAAG,CAACC,UAAU,CAAC,KAAK,CAAC;YACvE,MAAMkF,MAAM,GAAGF,MAAM,GAAG,OAAO,GAAIjF,GAAG,CAACC,UAAU,CAAC,KAAK,CAAC,GAAG,KAAK,GAAG,SAAU;YAC7E,MAAMmF,WAAW,GAAGH,MAAM,GAAGlH,MAAM,CAACsH,UAAU,GAAGtH,MAAM,CAACuH,QAAQ;YAChE,MAAMvB,UAAU,GAAGL,YAAY,CAAC1D,GAAG,EAAEmF,MAAM,CAAC;YAC5C,MAAMI,OAAO,GAAGN,MAAM,IAAKC,YAAY,IAAIpB,0BAA0B,CAAC9D,GAAG,CAAE;YAE3E,IAAI+D,UAAU,IAAIwB,OAAO,EAAE;cACvB,oBACGrH,OAAA;gBAAemG,SAAS,EAAEe,WAAY;gBAAAb,QAAA,eACpCrG,OAAA;kBAAGsH,KAAK,EAAE;oBAAEC,UAAU,EAAE;kBAAW,CAAE;kBAAAlB,QAAA,EAAER;gBAAU;kBAAAW,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAI;cAAC,GAD9CG,GAAG;gBAAAN,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAER,CAAC;YAEb;YACA,OAAO,IAAI;UACd,CAAC,CAAC,EAEDzF,SAAS,iBACRlB,OAAA;YAAKmG,SAAS,EAAEtG,MAAM,CAAC2H,gBAAiB;YAAAnB,QAAA,eACtCrG,OAAA;cAAAqG,QAAA,EAAI/E,eAAe,IAAI;YAAa;cAAAkF,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAI;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACtC,CACN,EACCvF,cAAc,KAAK,OAAO,IAAI,CAACF,SAAS,IAAI,CAACJ,OAAO,iBAClDd,OAAA;YAAKmG,SAAS,EAAE,GAAGtG,MAAM,CAACyB,eAAe,IAAIzB,MAAM,CAACwE,YAAY,EAAG;YAAAgC,QAAA,GAAC,SAAE,EAAC/E,eAAe;UAAA;YAAAkF,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM,CAC/F,eACD3G,OAAA;YAAKyH,GAAG,EAAEjG;UAAmB;YAAAgF,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC7B,CAAC,EAELvF,cAAc,KAAK,cAAc,IAAI,CAACN,OAAO,iBAC5Cd,OAAA;UAAMmG,SAAS,EAAEtG,MAAM,CAAC6H,YAAa;UAACC,QAAQ,EAAE3C,YAAa;UAAAqB,QAAA,gBAC3DrG,OAAA;YACE4H,IAAI,EAAC,MAAM;YACXC,WAAW,EAAC,0BAA0B;YACtCC,KAAK,EAAElH,YAAa;YACpBmH,QAAQ,EAAE9C,CAAC,IAAIpE,eAAe,CAACoE,CAAC,CAAC+C,MAAM,CAACF,KAAK,CAAE;YAC/CG,QAAQ;YACRC,QAAQ,EAAEhH;UAAU;YAAAsF,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACrB,CAAC,eACF3G,OAAA;YACE4H,IAAI,EAAC,QAAQ;YACbzB,SAAS,EAAEtG,MAAM,CAACsI,YAAa;YAC/BD,QAAQ,EAAEhH,SAAS,IAAI,CAACN,YAAY,CAACR,IAAI,CAAC,CAAE;YAAAiG,QAAA,EAE3CnF,SAAS,GAAG,YAAY,GAAG;UAAM;YAAAsF,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC5B,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACL,CACP;MAAA,eACD,CACH;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACE;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV;AAACnG,EAAA,CAjVuBD,YAAY;EAAA,QAChBX,WAAW;AAAA;AAAAwI,EAAA,GADP7H,YAAY;AAAA,IAAA6H,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}